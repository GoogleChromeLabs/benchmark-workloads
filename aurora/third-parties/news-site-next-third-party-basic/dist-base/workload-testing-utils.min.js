class TestInvoker{constructor(e,t,s,n=0){this._syncCallback=e,this._asyncCallback=t,this._reportCallback=s,this.waitBeforeSync=n}}export class TimerTestInvoker extends TestInvoker{start(){return new Promise((e=>{setTimeout((()=>{this._syncCallback(),setTimeout((()=>{this._asyncCallback(),requestAnimationFrame((async()=>{await this._reportCallback(),e()}))}),0)}),this.waitBeforeSync)}))}}class BaseRAFTestInvoker extends TestInvoker{start(){return new Promise((e=>{this.waitBeforeSync?setTimeout((()=>this._scheduleCallbacks(e)),this.waitBeforeSync):this._scheduleCallbacks(e)}))}}export class RAFTestInvoker extends BaseRAFTestInvoker{_scheduleCallbacks(e){requestAnimationFrame((()=>this._syncCallback())),requestAnimationFrame((()=>{setTimeout((()=>{this._asyncCallback(),setTimeout((async()=>{await this._reportCallback(),e()}),0)}),0)}))}}export class BenchmarkTestStep{constructor(e,t){this.name=e,this.fn=t}run(){this.fn()}async runAsync(e=0){return new Promise((t=>{this.fn(),setTimeout((()=>t()),e)}))}async runAndRecord({waitBeforeSync:e,measurementMethod:t,warmupBeforeSync:s,suitename:n,callback:r}){const a=`${n}.${this.name}-start`,o=`${n}.${this.name}-sync-end`,c=`${n}.${this.name}-async-start`,i=`${n}.${this.name}-async-end`;let m,u,l;return new("raf"===t?RAFTestInvoker:TimerTestInvoker)((()=>{if(s){performance.mark("warmup-start");const e=performance.now();for(;performance.now()-e<s;)continue;performance.mark("warmup-end")}performance.mark(a);const e=performance.now();this.run();const t=performance.now();performance.mark(o),m=t-e,performance.mark(c),u=performance.now()}),(()=>{const e=document.body.getBoundingClientRect().height,t=performance.now();l=t-u,window._unusedHeightValue=e,performance.mark(i),s&&performance.measure("warmup","warmup-start","warmup-end"),performance.measure(`${n}.${this.name}-sync`,a,o),performance.measure(`${n}.${this.name}-async`,c,i)}),(()=>r({suite:n,test:this.name,syncTime:m,asyncTime:l})),e).start()}}export class BenchmarkTestSuite{constructor(e,t){this.name=e,this.tests=t,this._measuredValues={tests:{},total:0,mean:NaN,geomean:NaN,score:NaN}}getTestByName(e){return this.tests.find((t=>t.name===e))}run(){for(const e of this.tests)e.run();return{type:"suite-tests-complete",status:"success"}}async runAndRecord({waitBeforeSync:e=0,measurementMethod:t="raf",warmupBeforeSync:s=-1}){this._measuredValues={tests:{},total:0,mean:NaN,geomean:NaN,score:NaN};const n=`suite-${this.name}-start`,r=`suite-${this.name}-end`;performance.mark(n);for(const n of this.tests)await n.runAndRecord({waitBeforeSync:e,measurementMethod:t,warmupBeforeSync:s,suitename:this.name,callback:this.record});return performance.mark(r),performance.measure(`suite-${this.name}`,n,r),{type:"suite-tests-complete",status:"success",result:this._measuredValues}}record({suite:e,test:t,syncTime:s,asyncTime:n}){const r=this._measuredValues.tests[e.name]||{tests:{},total:0},a=s+n;this._measuredValues.tests[e.name]=r,r.tests[t.name]={tests:{Sync:s,Async:n},total:a},r.total+=a}}export class BenchmarkTestManager{constructor(e,t){this.name=e,this.suites=t}getSuiteByName(e){return this.suites.find((t=>t.name===e))}run(e){console.log(`Starting tests for ${this.name}`);const t=e?this.suites.filter((t=>e.includes(t.name))):[...this.suites];for(const e of t)console.log(`Starting ${e.name} test.`),e.run(),console.log(`Completed ${e.name} test.`);return`Done with tests for ${this.name}`}async runAsync(e){console.log(`Starting tests for ${this.name}`);const t=e?this.suites.filter((t=>e.includes(t.name))):[...this.suites];for(const e of t)console.log(`Starting ${e.name} test.`),await e.runAsync(),console.log(`Completed ${e.name} test.`);return`Done with tests for ${this.name}`}}export function getParent(e,t){e=e.shadowRoot??e;return t.reduce(((e,t)=>{const s=e.querySelector(t);return s.shadowRoot??s}),e)}export function getElement(e,t=[],s=document){return getParent(s,t).querySelector(e)}export function getAllElements(e,t=[],s=document){return Array.from(getParent(s,t).querySelectorAll(e))}export function forceLayout(){const e=document.body.getBoundingClientRect();return document.elementFromPoint(e.width/2|0,e.height/2|0)}