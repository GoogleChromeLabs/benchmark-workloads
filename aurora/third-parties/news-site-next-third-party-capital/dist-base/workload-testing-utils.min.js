class TestInvoker{constructor(e,t,s,n=0){this._syncCallback=e,this._asyncCallback=t,this._reportCallback=s,this.waitBeforeSync=n}}export class TimerTestInvoker extends TestInvoker{start(){return new Promise((e=>{setTimeout((()=>{this._syncCallback(),setTimeout((()=>{this._asyncCallback(),requestAnimationFrame((async()=>{const t=await this._reportCallback();e(t)}))}),0)}),this.waitBeforeSync)}))}}class BaseRAFTestInvoker extends TestInvoker{start(){return new Promise((e=>{this.waitBeforeSync?setTimeout((()=>this._scheduleCallbacks(e)),this.waitBeforeSync):this._scheduleCallbacks(e)}))}}export class RAFTestInvoker extends BaseRAFTestInvoker{_scheduleCallbacks(e){requestAnimationFrame((()=>this._syncCallback())),requestAnimationFrame((()=>{setTimeout((()=>{this._asyncCallback(),setTimeout((async()=>{const t=await this._reportCallback();e(t)}),0)}),0)}))}}export class BenchmarkTestStep{constructor(e,t){this.name=e,this.fn=t}run(){this.fn()}async runAsync(e=0){return new Promise((t=>{this.fn(),setTimeout((()=>t()),e)}))}async runAndRecord({waitBeforeSync:e,measurementMethod:t,warmupBeforeSync:s,suitename:n,callback:r}){const a=`${n}.${this.name}-start`,o=`${n}.${this.name}-sync-end`,c=`${n}.${this.name}-async-start`,i=`${n}.${this.name}-async-end`;let m,u,l;return new("raf"===t?RAFTestInvoker:TimerTestInvoker)((()=>{if(s){performance.mark("warmup-start");const e=performance.now();for(;performance.now()-e<s;)continue;performance.mark("warmup-end")}performance.mark(a);const e=performance.now();this.run();const t=performance.now();performance.mark(o),m=t-e,performance.mark(c),u=performance.now()}),(()=>{const e=document.body.getBoundingClientRect().height,t=performance.now();l=t-u,window._unusedHeightValue=e,performance.mark(i),s&&performance.measure("warmup","warmup-start","warmup-end"),performance.measure(`${n}.${this.name}-sync`,a,o),performance.measure(`${n}.${this.name}-async`,c,i)}),(()=>r({syncTime:m,asyncTime:l})),e).start()}}export class BenchmarkTestSuite{constructor(e,t){this.name=e,this.tests=t}getTestByName(e){return this.tests.find((t=>t.name===e))}run(){for(const e of this.tests)e.run();return{type:"suite-tests-complete",status:"success"}}async runAndRecord({waitBeforeSync:e=0,measurementMethod:t="raf",warmupBeforeSync:s=-1}){const n={total:0},r=`suite-${this.name}-start`,a=`suite-${this.name}-end`;performance.mark(r);for(const r of this.tests){const a=await r.runAndRecord({waitBeforeSync:e,measurementMethod:t,warmupBeforeSync:s,suitename:this.name,callback:this.record});n[r.name]=a,n.total+=a.total}return performance.mark(a),performance.measure(`suite-${this.name}`,r,a),{type:"suite-tests-complete",status:"success",result:n,suitename:this.name}}record({syncTime:e,asyncTime:t}){const s=e+t,n={tests:{Sync:e,Async:t},total:s};return n.total+=s,n}}export class BenchmarkTestManager{constructor(e,t){this.name=e,this.suites=t}getSuiteByName(e){return this.suites.find((t=>t.name===e))}run(e){console.log(`Starting tests for ${this.name}`);const t=e?this.suites.filter((t=>e.includes(t.name))):[...this.suites];for(const e of t)console.log(`Starting ${e.name} test.`),e.run(),console.log(`Completed ${e.name} test.`);return`Done with tests for ${this.name}`}async runAsync(e){console.log(`Starting tests for ${this.name}`);const t=e?this.suites.filter((t=>e.includes(t.name))):[...this.suites];for(const e of t)console.log(`Starting ${e.name} test.`),await e.runAsync(),console.log(`Completed ${e.name} test.`);return`Done with tests for ${this.name}`}}export function getParent(e,t){e=e.shadowRoot??e;return t.reduce(((e,t)=>{const s=e.querySelector(t);return s.shadowRoot??s}),e)}export function getElement(e,t=[],s=document){return getParent(s,t).querySelector(e)}export function getAllElements(e,t=[],s=document){return Array.from(getParent(s,t).querySelectorAll(e))}export function forceLayout(){const e=document.body.getBoundingClientRect();return document.elementFromPoint(e.width/2|0,e.height/2|0)}